<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kairos C-E-R Practice</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM for building the UI -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-900">
    <!-- The React app will be rendered here -->
    <div id="root"></div>

    <script type="text/babel">
        // Because we are not in a Node.js environment, we cannot import libraries.
        // Instead, we define the icons as React components that return inline SVG.
        const Brain = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v1.13a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5V4.5A2.5 2.5 0 0 1 17.5 2h0A2.5 2.5 0 0 1 20 4.5v1.13a.5.5 0 0 0 .5.5h.38a2.12 2.12 0 0 1 2.12 2.12v.1a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-.1a2.12 2.12 0 0 1 2.12-2.12H5.5a.5.5 0 0 0 .5-.5V4.5A2.5 2.5 0 0 1 8.5 2h1Z"/><path d="M12 11.5a2.5 2.5 0 0 1 0-5h0A2.5 2.5 0 0 1 12 11.5Z"/><path d="M4.51 11.5A2.5 2.5 0 0 1 7 9.01V9.01A2.5 2.5 0 0 1 9.49 11.5h0A2.5 2.5 0 0 1 7 13.99v0A2.5 2.5 0 0 1 4.51 11.5Z"/><path d="M14.51 11.5A2.5 2.5 0 0 1 17 9.01V9.01A2.5 2.5 0 0 1 19.49 11.5h0A2.5 2.5 0 0 1 17 13.99v0A2.5 2.5 0 0 1 14.51 11.5Z"/><path d="M6 22a2 2 0 0 1-2-2v-3.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5V20a2 2 0 0 1-2 2Z"/><path d="M18 22a2 2 0 0 0 2-2v-3.5a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0-.5.5V20a2 2 0 0 0 2 2Z"/></svg> );
        const CheckCircle = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> );
        const Circle = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/></svg> );
        const Lock = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> );
        const ArrowRight = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg> );
        const Target = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg> );
        const Lightbulb = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg> );
        const Eye = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg> );
        const RotateCcw = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v6h6"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L3 12"/></svg> );
        const Home = (props) => ( <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg> );

        const { useState, useEffect, useRef } = React;

        // Shared Canvas Component
        const EvidenceCanvas = ({ width = 500, height = 240 }) => {
            const canvasRef = useRef(null);

            useEffect(() => {
                if (!canvasRef.current) return;
                
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const dpr = window.devicePixelRatio || 1;
                
                canvas.width = width * dpr;
                canvas.height = height * dpr;
                canvas.style.width = `${width}px`;
                canvas.style.height = `${height}px`;
                ctx.scale(dpr, dpr);
                
                // Draw scene
                ctx.fillStyle = '#1e293b'; // Background
                ctx.fillRect(0, 0, width, height);
                
                // Window frame
                ctx.fillStyle = '#6B4423'; // Brown
                ctx.fillRect(width - 140, 30, 120, 180);
                
                // Window panes
                ctx.fillStyle = '#87CEEB'; // Sky blue
                ctx.fillRect(width - 135, 35, 50, 80);
                ctx.fillRect(width - 75, 35, 50, 80);
                ctx.fillRect(width - 135, 125, 50, 80);
                ctx.fillRect(width - 75, 125, 50, 80);
                
                
                // Sun
                ctx.fillStyle = '#fbaf1b'; // Yellow
                ctx.beginPath();
                ctx.arc(width - 65, 70, 24, 0, Math.PI * 2);
                ctx.fill();
                
                // Sun rays
                for (let i = 0; i < 8; i++) {
                const angle = (i * Math.PI) / 4;
                ctx.strokeStyle = '#fbaf1b';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(width - 65 + Math.cos(angle) * 30, 70 + Math.sin(angle) * 30);
                ctx.lineTo(width - 65 + Math.cos(angle) * 40, 70 + Math.sin(angle) * 40);
                ctx.stroke();
                }
                
                // Pot
                ctx.fillStyle = '#8B4513'; // SaddleBrown
                ctx.fillRect(120, 180, 80, 50);
                
                // Soil
                ctx.fillStyle = '#654321'; // Dark brown
                ctx.fillRect(122, 180, 76, 15);
                
                // Plant stem
                ctx.strokeStyle = '#41ba78'; // Green
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.moveTo(160, 180);
                ctx.quadraticCurveTo(160, 130, width - 160, 100);
                ctx.stroke();
                
                // Leaves
                ctx.fillStyle = '#41ba78';
                for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.ellipse(width - 185 + i * 20, 110 - i * 12, 18, 10, -Math.PI / 6, 0, Math.PI * 2);
                ctx.fill();
                }
                
                // Labels
                ctx.fillStyle = '#e2e8f0'; // Light gray text
                ctx.font = 'bold 11px -apple-system, sans-serif';
                ctx.fillText('Window', width - 120, 25);
                ctx.fillText('Plant', 135, 175);
                
                // Arrow showing phototropism
                ctx.strokeStyle = '#f15c49'; // Red arrow
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(220, 140);
                ctx.lineTo(width - 180, 140);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(width - 180, 140);
                ctx.lineTo(width - 190, 135);
                ctx.moveTo(width - 180, 140);
                ctx.lineTo(width - 190, 145);
                ctx.stroke();

            }, [width, height]);

            return (
                <canvas 
                ref={canvasRef} 
                className="rounded-lg shadow-lg w-full"
                role="img"
                aria-label="An illustration of a plant on a desk bending towards sunlight coming through a window."
                />
            );
        };


        // Main Application Component
        const KairosCERLearning = () => {
            const [currentView, setCurrentView] = useState('hub');
            const [currentModule, setCurrentModule] = useState(null);
            const [reasoningText, setReasoningText] = useState('');
            const [finalAnswers, setFinalAnswers] = useState({ claim: '', evidence: '', reasoning: '' });
            const [moduleProgress, setModuleProgress] = useState({
                phototropism: { unlocked: true, build: false, reasoning: false },
                osmosis: { unlocked: false, build: false, reasoning: false },
            });

            const modules = {
                phototropism: {
                id: 'phototropism',
                title: 'Phototropism',
                icon: Lightbulb,
                description: 'Investigate how plants respond to light.',
                claim: 'The plant is growing towards the window.',
                areas: [
                    { id: 'plant', name: 'The Plant' },
                    { id: 'window', name: 'The Window' },
                ],
                descriptions: [
                    { id: 'd1', areaId: 'plant', text: 'The plant stem is bending.', correct: true },
                    { id: 'd2', areaId: 'plant', text: 'The plant has green leaves.', correct: false },
                    { id: 'd3', areaId: 'plant', text: 'The plant is in a brown pot.', correct: false },
                    { id: 'd4', areaId: 'window', text: 'Sunlight is coming through the window.', correct: true },
                    { id: 'd5', areaId: 'window', text: 'The window has a frame.', correct: false },
                ],
                reasoningPrompt: 'Based on your evidence, explain the scientific principle that causes the plant to grow towards the window. Use the term "phototropism".'
                },
                osmosis: {
                id: 'osmosis',
                title: 'Osmosis',
                icon: Circle, // Placeholder icon
                description: 'Explore how water moves across membranes.',
                claim: 'This module is not yet implemented.'
                }
            };

            const Icon = ({ of, ...props }) => {
                const IconComponent = of;
                return <IconComponent {...props} />;
            }

            const handleSelectModule = (moduleId) => {
                if (moduleProgress[moduleId].unlocked) {
                setCurrentModule(moduleId);
                setCurrentView('module');
                }
            };

            const HubView = () => (
                <div className="w-full max-w-4xl mx-auto">
                <div className="text-center mb-12">
                    <h1 className="text-4xl md:text-5xl font-bold text-slate-100">C-E-R Practice</h1>
                    <p className="text-slate-400 mt-2 text-lg">Select a module to begin building your scientific argument.</p>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    {Object.values(modules).map(module => {
                    const progress = moduleProgress[module.id];
                    const isLocked = !progress.unlocked;
                    const isComplete = progress.build && progress.reasoning;

                    return (
                        <div
                        key={module.id}
                        onClick={() => handleSelectModule(module.id)}
                        className={`bg-slate-800 p-8 rounded-2xl transition-all duration-300 transform hover:-translate-y-2 flex flex-col ${isLocked ? 'opacity-50' : 'cursor-pointer hover:shadow-2xl hover:shadow-cyan-500/20'}`}
                        >
                        <div className="flex-1">
                            <div className="flex items-center justify-between mb-4">
                            <div className="p-3 bg-slate-900 rounded-lg">
                                <Icon of={module.icon} className="w-8 h-8 text-cyan-400" />
                            </div>
                            {isLocked && <Lock className="w-6 h-6 text-slate-500" />}
                            {isComplete && <CheckCircle className="w-6 h-6 text-green-500" />}
                            </div>
                            <h2 className="text-2xl font-bold text-slate-100 mb-2">{module.title}</h2>
                            <p className="text-slate-400">{module.description}</p>
                        </div>
                        <div className="mt-6">
                            {!isLocked && (
                            <div className="w-full bg-slate-700 rounded-full h-2.5">
                                <div className="bg-gradient-to-r from-cyan-400 to-blue-500 h-2.5 rounded-full" style={{ width: `${isComplete ? 100 : (progress.build ? 50 : 0)}%` }}></div>
                            </div>
                            )}
                        </div>
                        </div>
                    );
                    })}
                </div>
                </div>
            );

            const ModuleView = ({ module, onBack }) => {
                const progress = moduleProgress[module.id];

                const startSection = (section) => {
                    if (section === 'build' && !progress.build) {
                        setFinalAnswers({ claim: module.claim, evidence: '', reasoning: '' });
                        setCurrentView('evidence');
                    }
                    if (section === 'reasoning' && progress.build && !progress.reasoning) {
                        setCurrentView('reasoning');
                    }
                };

                return (
                <div className="w-full max-w-3xl mx-auto">
                    <button onClick={onBack} className="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors mb-8">
                    <Home className="w-5 h-5" />
                    <span>Back to Hub</span>
                    </button>
                    <div className="bg-slate-800 p-8 rounded-2xl">
                    <div className="flex items-center gap-4 mb-6">
                        <div className="p-3 bg-slate-900 rounded-lg">
                        <Icon of={module.icon} className="w-8 h-8 text-cyan-400" />
                        </div>
                        <h1 className="text-3xl font-bold text-slate-100">{module.title}</h1>
                    </div>
                    
                    <div className="space-y-6">
                        {/* Claim */}
                        <div className="bg-slate-900/50 p-6 rounded-lg">
                        <div className="flex items-center gap-3">
                            <Target className="w-6 h-6 text-cyan-400" />
                            <h3 className="text-xl font-semibold text-slate-200">Claim</h3>
                            <CheckCircle className="w-5 h-5 text-green-500" />
                        </div>
                        <p className="text-slate-300 mt-2 pl-9">{module.claim}</p>
                        </div>
                        
                        {/* Evidence */}
                        <div onClick={() => startSection('build')} className={`bg-slate-900/50 p-6 rounded-lg transition-all ${!progress.build ? 'cursor-pointer hover:bg-slate-700/50' : ''}`}>
                        <div className="flex items-center gap-3">
                            <Eye className="w-6 h-6 text-cyan-400" />
                            <h3 className="text-xl font-semibold text-slate-200">Evidence</h3>
                            {progress.build ? <CheckCircle className="w-5 h-5 text-green-500" /> : <ArrowRight className="w-5 h-5 text-slate-400" />}
                        </div>
                        {progress.build ?
                            <p className="text-slate-300 mt-2 pl-9 whitespace-pre-wrap">{finalAnswers.evidence}</p> :
                            <p className="text-slate-400 mt-2 pl-9">Click here to build your evidence.</p>
                        }
                        </div>

                        {/* Reasoning */}
                        <div onClick={() => startSection('reasoning')} className={`bg-slate-900/50 p-6 rounded-lg transition-all ${progress.build ? 'cursor-pointer hover:bg-slate-700/50' : 'opacity-50'}`}>
                        <div className="flex items-center gap-3">
                            <Brain className="w-6 h-6 text-cyan-400" />
                            <h3 className="text-xl font-semibold text-slate-200">Reasoning</h3>
                            {progress.reasoning ? <CheckCircle className="w-5 h-5 text-green-500" /> : (progress.build ? <ArrowRight className="w-5 h-5 text-slate-400" /> : <Lock className="w-5 h-5 text-slate-500" />)}
                        </div>
                        {progress.reasoning ?
                            <p className="text-slate-300 mt-2 pl-9">{finalAnswers.reasoning}</p> :
                            <p className="text-slate-400 mt-2 pl-9">{progress.build ? 'Click here to write your reasoning.' : 'Complete the evidence section to unlock.'}</p>
                        }
                        </div>
                    </div>
                    </div>
                </div>
                );
            };
            
            const EvidenceView = ({ module, onBack }) => {
                const { areas, descriptions } = module;
                const [selections, setSelections] = useState(() => {
                    const initialState = {};
                    areas.forEach(area => initialState[area.id] = []);
                    return initialState;
                });
                const [allCorrect, setAllCorrect] = useState(false);
                const [allSelected, setAllSelected] = useState(false);
                
                useEffect(() => {
                const allSelectedCheck = areas.every(area =>
                    selections[area.id] && selections[area.id].length > 0
                );
                setAllSelected(allSelectedCheck);

                if (allSelectedCheck) {
                    const allCorrectCheck = areas.every(area => {
                    const areaSelections = selections[area.id];
                    const correctDescs = descriptions.filter(d => d.areaId === area.id && d.correct);
                    const incorrectDescs = descriptions.filter(d => d.areaId === area.id && !d.correct);

                    return (
                        correctDescs.every(d => areaSelections.some(s => s.id === d.id)) &&
                        incorrectDescs.every(d => !areaSelections.some(s => s.id === d.id)) &&
                        areaSelections.length === correctDescs.length
                    );
                    });
                    setAllCorrect(allCorrectCheck);
                } else {
                    setAllCorrect(false);
                }
                }, [selections, areas, descriptions]);

                const handleSelect = (areaId, desc) => {
                setSelections(prev => {
                    const areaSelections = prev[areaId];
                    const isSelected = areaSelections.some(d => d.id === desc.id);
                    if (isSelected) {
                    return { ...prev, [areaId]: areaSelections.filter(d => d.id !== desc.id) };
                    } else {
                    return { ...prev, [areaId]: [...areaSelections, desc] };
                    }
                });
                };

                const resetSelections = () => {
                    const initialState = {};
                    areas.forEach(area => initialState[area.id] = []);
                    setSelections(initialState);
                };

                const completeEvidence = () => {
                    const evidenceList = areas.map(area => {
                        return selections[area.id]
                            .filter(d => d.correct)
                            .map(d => d.text)
                            .join('; ');
                    }).filter(Boolean);
                    
                    const complete = evidenceList.map((e, i) => `${i + 1}. ${e}`).join('\n');
                    setFinalAnswers(prev => ({ ...prev, evidence: complete }));
                    setModuleProgress(prev => ({
                        ...prev,
                        [currentModule]: { ...prev[currentModule], build: true }
                    }));
                    setCurrentView('module');
                };

                return (
                <div className="w-full max-w-5xl mx-auto">
                    <button onClick={onBack} className="flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors mb-8">
                    <Home className="w-5 h-5" />
                    <span>Back to Module</span>
                    </button>

                    <div className="bg-slate-800 p-4 md:p-8 rounded-2xl">
                    <div className="text-center mb-6">
                        <h2 className="text-2xl md:text-3xl font-bold text-slate-100">Build Your Evidence</h2>
                        <p className="text-slate-400 mt-1">Select the observations that best support the claim: <span className="font-semibold text-slate-300">"{module.claim}"</span></p>
                    </div>
                    
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
                        <div className="w-full aspect-[2.08/1] bg-slate-900 rounded-lg overflow-hidden">
                            <EvidenceCanvas />
                        </div>

                        <div className="flex flex-col justify-between">
                        <div>
                            {areas.map(area => (
                            <div key={area.id} className="mb-4">
                                <h3 className="font-bold text-lg text-slate-200 border-b-2 border-slate-700 pb-2 mb-3">{area.name}</h3>
                                <div className="flex flex-col space-y-2">
                                {descriptions.filter(d => d.areaId === area.id).map(desc => {
                                    const isSelected = selections[area.id].some(d => d.id === desc.id);
                                    return (
                                    <button
                                        key={desc.id}
                                        onClick={() => handleSelect(area.id, desc)}
                                        className={`text-left p-3 rounded-md transition-colors text-sm md:text-base flex items-center gap-3 ${isSelected ? 'bg-cyan-500/20 text-cyan-300' : 'bg-slate-700/50 hover:bg-slate-700 text-slate-300'}`}
                                    >
                                        {isSelected ? <CheckCircle className="w-5 h-5 text-cyan-400 flex-shrink-0" /> : <Circle className="w-5 h-5 text-slate-500 flex-shrink-0" />}
                                        {desc.text}
                                    </button>
                                    );
                                })}
                                </div>
                            </div>
                            ))}
                        </div>
                        
                        <div className="flex flex-col md:flex-row gap-3 mt-4">
                            <button 
                            onClick={resetSelections}
                            className="flex-1 bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-3 md:py-4 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm md:text-base"
                            >
                            <RotateCcw className="w-4 h-4 md:w-5 md:h-5" />
                            Reset
                            </button>
                            {allCorrect && allSelected && (
                            <button
                                onClick={completeEvidence}
                                className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold py-3 md:py-4 rounded-lg transition-all hover:scale-105 flex items-center justify-center gap-2 text-sm md:text-base"
                            >
                                Complete Evidence
                                <CheckCircle className="w-4 h-4 md:w-5 md:h-5" />
                            </button>
                            )}
                        </div>
                        </div>
                    </div>
                    </div>
                </div>
                );
            }

            const renderView = () => {
                switch (currentView) {
                case 'module':
                    return <ModuleView module={modules[currentModule]} onBack={() => setCurrentView('hub')} />;
                case 'evidence':
                    return <EvidenceView module={modules[currentModule]} onBack={() => setCurrentView('module')} />;
                case 'hub':
                default:
                    return <HubView />;
                }
            };

            return (
                <div className="bg-slate-900 text-white min-h-screen p-4 sm:p-6 md:p-8 flex items-center justify-center font-sans">
                {renderView()}
                </div>
            );
        };

        ReactDOM.render(
            <KairosCERLearning />,
            document.getElementById('root')
        );
    </script>
</body>
</html>
